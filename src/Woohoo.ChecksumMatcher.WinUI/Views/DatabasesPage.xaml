<Page
    x:Class="Woohoo.ChecksumMatcher.WinUI.Views.DatabasesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="using:Woohoo.ChecksumMatcher.WinUI.Behaviors"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="using:Woohoo.ChecksumMatcher.WinUI.Views"
    xmlns:vms="using:Woohoo.ChecksumMatcher.WinUI.ViewModels"
    mc:Ignorable="d">
    <Page.Resources>
        <!--  Put this Page attribute to remove the header  -->
        <!--  behaviors:NavigationViewHeaderBehavior.HeaderMode="Never"  -->

        <DataTemplate x:Key="TreeNoSelectionTemplate" x:DataType="vms:DatabaseTreeItemViewModel">
            <Grid />
        </DataTemplate>

        <DataTemplate x:Key="TreeFolderTemplate" x:DataType="vms:DatabaseFolderTreeItemViewModel">
            <TreeViewItem
                AutomationProperties.Name="{x:Bind Name}"
                IsExpanded="{x:Bind IsExpanded}"
                ItemsSource="{x:Bind Children}">
                <StackPanel Orientation="Horizontal">
                    <FontIcon Glyph="&#xE8B7;" />
                    <TextBlock Margin="0,0,10,0" />
                    <TextBlock Text="{x:Bind Name}" />
                </StackPanel>
            </TreeViewItem>
        </DataTemplate>

        <DataTemplate x:Key="TreeFileTemplate" x:DataType="vms:DatabaseFileTreeItemViewModel">
            <TreeViewItem AutomationProperties.Name="{x:Bind FileName}">
                <StackPanel Orientation="Horizontal">
                    <FontIcon Glyph="&#xE8A5;" />
                    <TextBlock Margin="0,0,10,0" />
                    <TextBlock Text="{x:Bind FileName}" />
                </StackPanel>
            </TreeViewItem>
        </DataTemplate>

        <DataTemplate x:Key="DetailsNoSelectionTemplate" x:DataType="vms:DatabaseTreeItemViewModel">
            <Grid>
                <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Style="{ThemeResource SubtitleTextBlockStyle}"
                    TextAlignment="Center">
                    No Selection
                </TextBlock>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="DetailsFolderTemplate" x:DataType="vms:DatabaseFolderTreeItemViewModel">
            <views:DatabaseFolderDetailControl />
        </DataTemplate>

        <DataTemplate x:Key="DetailsTreeFileTemplate" x:DataType="vms:DatabaseFileTreeItemViewModel">
            <views:DatabaseFileDetailControl Database="{x:Bind Database}" />
        </DataTemplate>

        <DataTemplate x:Key="DetailsTreeFileNotLoadedTemplate" x:DataType="vms:DatabaseFileTreeItemViewModel">
            <TextBlock
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Style="{ThemeResource SubtitleTextBlockStyle}"
                Text="Please wait..." />
        </DataTemplate>

        <views:DatabaseTreeItemTemplateSelector
            x:Key="TreeItemTemplateSelector"
            FileNotLoadedTemplate="{StaticResource TreeFileTemplate}"
            FileTemplate="{StaticResource TreeFileTemplate}"
            FolderTemplate="{StaticResource TreeFolderTemplate}" />

        <views:DatabaseTreeItemTemplateSelector
            x:Key="DetailsItemTemplateSelector"
            FileNotLoadedTemplate="{StaticResource DetailsTreeFileNotLoadedTemplate}"
            FileTemplate="{StaticResource DetailsTreeFileTemplate}"
            FolderTemplate="{StaticResource DetailsFolderTemplate}"
            NoSelectionTemplate="{StaticResource DetailsNoSelectionTemplate}" />
    </Page.Resources>

    <Grid x:Name="ContentArea">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>

            <!--  Left-side 'Shelf', In this case you could also use a GridSplitter  -->
            <Border
                x:Name="SideContent"
                Width="400"
                Margin="0,8,0,24">
                <TreeView
                    x:Name="TreeView1"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Top"
                    ItemTemplateSelector="{StaticResource TreeItemTemplateSelector}"
                    ItemsSource="{x:Bind ViewModel.DataSource}"
                    SelectedItem="{x:Bind ViewModel.Selected, Mode=TwoWay}"
                    SelectionChanged="TreeView1_SelectionChanged"
                    SelectionMode="Single" />
            </Border>
            <controls:ContentSizer Grid.Column="1" TargetControl="{x:Bind SideContent}" />

            <ContentControl
                Grid.Column="2"
                Margin="20,0"
                HorizontalContentAlignment="Stretch"
                VerticalContentAlignment="Stretch"
                Content="{x:Bind ViewModel.Selected, Mode=OneWay}"
                ContentTemplateSelector="{StaticResource DetailsItemTemplateSelector}"
                DataContext="{x:Bind ViewModel.Selected}" />
        </Grid>
    </Grid>
</Page>
